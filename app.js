const translations = {
  zh: {
    meta: {
      title: "媽咪全知道｜全階段孕產育兒陪伴平台",
    },
    nav: {
      brand: "媽咪全知道",
      features: "核心功能",
      planner: "週期計畫",
      kits: "智慧工具",
      community: "社群",
      affiliate: "好物推薦",
      langButton: "English",
      langButtonLabel: "切換語言",
      cta: "立即開始",
      mobileMenuLabel: "開啟選單",
    },
    hero: {
      tagline: "全階段孕產育兒陪伴 · 聯盟營銷一站整合",
      title: "媽咪全知道，為你把孕期到 36 個月的每一步打理好",
      subtitle:
        "集結專業知識、智慧提醒、入院包清單與社群支援，讓準爸媽安心掌握孕產大小事，輕鬆購齊必備好物。",
      primaryCta: "探索我的旅程",
      secondaryCta: "查看功能亮點",
      card: {
        tag: "智慧提示",
        title: "今日暖心提醒",
        description:
          "懷孕第 20 週 · 胎動變得明顯，可以安排 10 分鐘伸展放鬆骨盆；記得補充足量鈣質。",
        item1: "📅 下次產檢 · 9 月 25 日 · 例行檢查＋妊娠糖尿篩檢",
        item2: "🍼 寶寶疫苗 · 9 月 30 日 · 五合一疫苗第 2 劑",
        item3: "🛒 今日推薦 · DHA 軟膠囊、孕婦托腹褲、胎教音樂",
      },
    },
    features: {
      title: "八大核心功能 · 滿足孕產家庭的每個需求",
      description:
        "從備孕、孕期、產後到幼兒 36 個月，以情境化工具與內容服務陪伴每一個關鍵時刻。",
      card1: {
        title: "懷孕準備指南",
        text: "排卵期計算器、備孕飲食與生活調整清單，一鍵收藏葉酸、排卵試紙等入門好物。",
      },
      card2: {
        title: "孕期照護分階段",
        text: "第一孕期到產前分段顯示營養、運動與產檢提醒，穿插孕婦枕、托腹褲、DHA 推薦。",
      },
      card3: {
        title: "產檢追蹤與提醒",
        text: "輸入預產期自動生成產檢與檢測時程，支援推播與行事曆整合。",
      },
      card4: {
        title: "入院前準備包",
        text: "媽媽包、寶寶包清單一次掌握，勾選即可加入購物平台，減少遺漏。",
      },
      card5: {
        title: "產後恢復照護",
        text: "產後 1-6 週恢復重點、惡露觀察與情緒照護，延伸月子中心與塑腹帶資源。",
      },
      card6: {
        title: "新生兒 0–36 個月照護",
        text: "依月齡提供作息、飲食、疫苗與發展指標，搭配奶瓶、學步鞋等好物。",
      },
      card7: {
        title: "社群與問答",
        text: "匿名發問、專家回覆、熱門標籤與商品建議，打造安心支持圈。",
      },
      card8: {
        title: "收藏與清單",
        text: "知識文章、實用工具、商品一次收藏，分類管理同步提醒。",
      },
    },
    planner: {
      title: "依你的旅程，智慧引導每個階段",
      description:
        "選擇所在階段，立即掌握重要任務、健康提醒與推薦資源，為每一步做好準備。",
      stageSwitcherLabel: "孕產階段選單",
      tabs: {
        pregnancy: "孕期階段",
        postpartum: "產後恢復",
        baby: "0–36 個月",
      },
      pregnancy: {
        card1: {
          title: "第 1–12 週",
          item1: "補充葉酸與 DHA，建立孕吐舒緩飲食。",
          item2: "安排初次產檢、確認子宮頸抹片與抽血檢查。",
          item3: "推薦：葉酸錠、孕期維他命、孕婦營養湯品。",
        },
        card2: {
          title: "第 13–27 週",
          item1: "加強攝取鈣質與鐵質，建立規律伸展運動。",
          item2: "密切留意胎動，安排妊娠糖尿篩檢。",
          item3: "推薦：孕婦枕、托腹褲、產前瑜伽課程。",
        },
        card3: {
          title: "第 28 週至生產",
          item1: "每週胎動紀錄、追蹤胎位與羊水量。",
          item2: "準備待產包、討論生產計畫與陪產安排。",
          item3: "推薦：待產包組、溢乳墊、醫院入住用品。",
        },
      },
      postpartum: {
        card1: {
          title: "第 1 週",
          item1: "惡露顏色觀察、子宮收縮追蹤。",
          item2: "協助哺乳諮詢，建立正確姿勢。",
          item3: "推薦：月子中心巡房、溫和洗護組。",
        },
        card2: {
          title: "第 2–4 週",
          item1: "骨盆底肌修復練習、情緒支持諮詢。",
          item2: "建立休息與哺乳節奏。",
          item3: "推薦：骨盆塑腹帶、調理湯品、心理諮商。",
        },
        card3: {
          title: "第 5–6 週",
          item1: "安排產後檢查、收集哺乳與返工規劃。",
          item2: "開啟輕量運動，評估泌乳狀況。",
          item3: "推薦：產後瑜伽、乳腺按摩、營養補充包。",
        },
      },
      baby: {
        card1: {
          title: "0–2 個月",
          item1: "餵奶頻率、睡眠安撫、黃疸觀察。",
          item2: "疫苗：出生 BCG、B 型肝炎；滿月聽力篩檢。",
          item3: "推薦：奶瓶消毒鍋、新生兒包巾、寶寶床。",
        },
        card2: {
          title: "2–6 個月",
          item1: "翻身練習、手眼協調互動遊戲。",
          item2: "疫苗：五合一、肺炎鏈球菌、輪狀病毒。",
          item3: "推薦：健力毯、牙膠玩具、翻身枕。",
        },
        card3: {
          title: "6–12 個月",
          item1: "副食品導入、爬行與站立練習。",
          item2: "疫苗：麻疹腮腺炎德國麻疹、B 型肝炎加強。",
          item3: "推薦：副食品機、學習餐具、軟質學步鞋。",
        },
        card4: {
          title: "12–24 個月",
          item1: "語彙刺激、日夜作息穩定。",
          item2: "疫苗：第二劑麻疹腮腺炎德國麻疹、流感季節。",
          item3: "推薦：故事繪本、幼兒安全餐椅、親子課程。",
        },
        card5: {
          title: "24–36 個月",
          item1: "自主如廁練習、情緒表達引導。",
          item2: "疫苗：五合一追加、口服小兒麻痺。",
          item3: "推薦：情境角色扮演玩具、平衡車、幼兒背包。",
        },
      },
    },
    kits: {
      title: "智慧工具 · 讓任務更輕鬆",
      description:
        "整合實用工具與清單模板，協助準備、追蹤與規劃，打造專屬孕產作戰地圖。",
      card1: {
        title: "排卵與預產計算器",
        text: "輸入月經週期即可推算排卵期與預產期，搭配備孕注意事項與營養建議。",
        badge1: "備孕規劃",
        badge2: "行事曆串接",
      },
      card2: {
        title: "產檢提醒行事曆",
        text: "依孕期自動生成產檢、產篩與衛教課程時程，可一鍵加入 Google / Apple 行事曆。",
        badge1: "自動提醒",
        badge2: "與伴侶共享",
      },
      card3: {
        title: "入院前準備清單",
        text: "預設媽媽包、寶寶包與文件項目，可客製及勾選完成度，同步購物清單。",
        badge1: "快速打包",
        badge2: "聯盟串接",
      },
      card4: {
        title: "產後恢復追蹤",
        text: "記錄惡露顏色、情緒日記與哺乳筆記，系統自動提出專家建議。",
        badge1: "恢復日誌",
        badge2: "專家問答",
      },
      card5: {
        title: "寶寶成長里程碑",
        text: "0–36 個月發展指標提示，對應遊戲互動與親子活動建議，一鍵儲存成長相簿。",
        badge1: "月齡提醒",
        badge2: "互動練習",
      },
      card6: {
        title: "收藏清單中心",
        text: "知識文章、營養食譜、商品等分類收藏，支援備註與結帳提醒。",
        badge1: "跨裝置同步",
        badge2: "分享家人",
      },
    },
    affiliate: {
      title: "精選好物相伴 · 一鍵購買不手忙腳亂",
      description:
        "依旅程貼心分組推薦，讓你在閱讀知識時，也能即時下單準備所需用品。",
      card1: {
        category: "備孕",
        title: "葉酸營養組",
        text: "專為備孕與初期孕媽設計的綜合維他命，補足關鍵葉酸與 B 群。",
        link: "查看聯盟連結 →",
      },
      card2: {
        category: "孕期舒緩",
        title: "托腹褲與孕婦枕",
        text: "釋放腰背壓力，夜間更好眠，減少抽筋與下肢水腫困擾。",
        link: "查看聯盟連結 →",
      },
      card3: {
        category: "待產包",
        title: "媽媽包必備套組",
        text: "從產褥墊到溢乳垫一次備妥，入院即可安心使用。",
        link: "查看聯盟連結 →",
      },
      card4: {
        category: "寶寶日常",
        title: "奶瓶清潔與副食品機",
        text: "輕鬆完成消毒與副食品製作，讓寶寶飲食更安心。",
        link: "查看聯盟連結 →",
      },
      card5: {
        category: "學習成長",
        title: "學步鞋與平衡車",
        text: "強化平衡與肌力發展，陪伴寶寶自信探索世界。",
        link: "查看聯盟連結 →",
      },
      card6: {
        category: "媽媽自我照護",
        title: "產後塑身與舒壓組",
        text: "調理體態與情緒放鬆共存，打造健康身心。",
        link: "查看聯盟連結 →",
      },
    },
    community: {
      title: "社群與問答，讓你不再孤單",
      description: "匿名提問、專家直播、暖心互助，一起建立最真實的育兒支持圈。",
      card1: {
        tag: "#哺乳",
        text: "「寶寶半夜頻頻醒來怎麼辦？」10 位媽媽分享實測哄睡法，專家線上指導含哺乳姿勢調整。",
      },
      card2: {
        tag: "#疫苗",
        text: "疫苗時程查詢＋提醒同步推播，專家解析常見副作用與舒緩技巧。",
      },
      card3: {
        tag: "#副食品",
        text: "提供分階段副食品菜單與營養建議，搭配副食品機折扣分享。",
      },
      card4: {
        tag: "#情緒支持",
        text: "產後情緒上線匿名分享，心理師與社群夥伴陪伴你度過轉換期。",
      },
      cta: "預約加入社群",
      alert: "社群功能即將開放，敬請期待！",
    },
    delivery: {
      title: "專屬收藏，所有靈感一次整理",
      description: "把常用文章、購物清單、提醒與寶寶成長記錄收進個人中心，跨裝置即時同步。",
      card1: {
        title: "知識庫收藏",
        text: "文章、影音、專家講堂自動按階段排列，可標註重點段落。",
      },
      card2: {
        title: "商品追蹤",
        text: "將感興趣的商品加入購物清單，取得價格提醒與促銷小提示。",
      },
      card3: {
        title: "提醒一覽",
        text: "產檢、疫苗、活動課程與自訂提醒集中管理，支援分享給家人。",
      },
    },
    cta: {
      title: "準備好啟動你的孕產旅程了嗎？",
      description: "媽咪全知道整合計畫、內容、提醒與好物，只要加入會員即可快速設定你的專屬顧問。",
      primaryCta: "免費建立帳號",
      secondaryCta: "聯絡專人",
    },
    footer: {
      brand: "媽咪全知道",
      tagline: "全方位孕產育兒指南 · 智慧提醒 · 聯盟好物推薦。",
      resources: {
        title: "資源",
        item1: "功能導覽",
        item2: "階段指南",
        item3: "智慧工具",
      },
      support: {
        title: "支援",
        item1: "社群 Q&A",
        item2: "品牌合作",
        item3: "會員服務",
      },
      follow: {
        title: "追蹤我們",
        item1: "Instagram",
        item2: "Facebook",
        item3: "YouTube",
      },
    },
  },
  en: {
    meta: {
      title: "Mum All Known | Pregnancy and parenting companion",
    },
    nav: {
      brand: "Mum All Known",
      features: "Key Features",
      planner: "Journey Planner",
      kits: "Smart Tools",
      community: "Community",
      affiliate: "Top Picks",
      langButton: "中文",
      langButtonLabel: "Switch language",
      cta: "Get Started",
      mobileMenuLabel: "Open navigation menu",
    },
    hero: {
      tagline: "Full-journey pregnancy support · All-in-one affiliate hub",
      title: "Mum All Known keeps every step from pregnancy to 36 months on track",
      subtitle:
        "Expert knowledge, smart reminders, hospital bag checklists, and community guidance—everything expectant parents need in one place.",
      primaryCta: "Explore My Path",
      secondaryCta: "See Feature Highlights",
      card: {
        tag: "Smart Tip",
        title: "Today’s Gentle Reminder",
        description:
          "Pregnancy week 20 · Baby’s movements are clearer—schedule a 10-minute stretch for your pelvis and remember calcium support.",
        item1:
          "📅 Next prenatal visit · Sep 25 · Routine check plus gestational diabetes screening",
        item2: "🍼 Baby vaccines · Sep 30 · Second dose of 5-in-1 vaccine",
        item3: "🛒 Today’s picks · DHA softgels, maternity support leggings, prenatal music",
      },
    },
    features: {
      title: "Eight core features for every family milestone",
      description:
        "From preconception to the toddler years, scenario-based tools and content walk with you through every key moment.",
      card1: {
        title: "Preconception Playbook",
        text: "Ovulation calculator, nutrition guides, and lifestyle checklists with quick links to folic acid and test kits.",
      },
      card2: {
        title: "Trimester-by-trimester Care",
        text: "Track nutrition, movement, and prenatal visits each trimester alongside curated pillows, belly bands, and DHA.",
      },
      card3: {
        title: "Prenatal Tracker & Reminders",
        text: "Enter your due date to auto-build appointment schedules with calendar sync and push alerts.",
      },
      card4: {
        title: "Hospital Bag Prep",
        text: "One checklist for mom and baby with quick add-to-cart options so nothing gets missed.",
      },
      card5: {
        title: "Postpartum Recovery Support",
        text: "Week-by-week recovery focus, lochia monitoring, emotional care, and partner resources.",
      },
      card6: {
        title: "Newborn to 36 Months",
        text: "Monthly routines, feeding, vaccines, and milestones paired with bottles, shoes, and more.",
      },
      card7: {
        title: "Community Q&A",
        text: "Anonymous questions, expert replies, trending tags, and product ideas for a supportive circle.",
      },
      card8: {
        title: "Saved Items & Lists",
        text: "Bookmark articles, tools, and products in organized collections with gentle reminders.",
      },
    },
    planner: {
      title: "Guidance tailored to every stage of your journey",
      description:
        "Pick where you are to surface critical tasks, health reminders, and curated resources so you’re always prepared.",
      stageSwitcherLabel: "Pregnancy journey tabs",
      tabs: {
        pregnancy: "Pregnancy Stage",
        postpartum: "Postpartum",
        baby: "Baby 0–36 Months",
      },
      pregnancy: {
        card1: {
          title: "Weeks 1–12",
          item1: "Boost folic acid and DHA, and find meals that soothe morning sickness.",
          item2: "Book your first prenatal visit plus Pap and blood work.",
          item3: "Suggested: folic acid tablets, prenatal vitamins, nourishing soups.",
        },
        card2: {
          title: "Weeks 13–27",
          item1: "Increase calcium and iron while building a gentle stretch routine.",
          item2: "Track baby movements and schedule the glucose tolerance screening.",
          item3: "Suggested: maternity pillow, support belt, prenatal yoga classes.",
        },
        card3: {
          title: "Week 28 to birth",
          item1: "Log daily kicks and monitor baby’s position and amniotic fluid.",
          item2: "Finalize your birth plan, pack the hospital bag, and align support.",
          item3: "Suggested: hospital bag bundle, breast pads, admission essentials.",
        },
      },
      postpartum: {
        card1: {
          title: "Week 1",
          item1: "Watch lochia flow and uterine contractions for healthy recovery.",
          item2: "Connect with lactation support to refine positioning.",
          item3: "Suggested: confinement center walk-through, gentle care kit.",
        },
        card2: {
          title: "Weeks 2–4",
          item1: "Strengthen pelvic floor muscles and access emotional support.",
          item2: "Stabilize your rest and feeding rhythm.",
          item3: "Suggested: postpartum wrap, nourishing soups, counseling sessions.",
        },
        card3: {
          title: "Weeks 5–6",
          item1: "Schedule your checkup and plan for feeding and work transitions.",
          item2: "Start light workouts and review milk supply.",
          item3: "Suggested: postpartum yoga, breast care massage, nutrition packs.",
        },
      },
      baby: {
        card1: {
          title: "0–2 Months",
          item1: "Manage feeding frequency, soothing routines, and jaundice checks.",
          item2: "Vaccines: BCG, Hep B at birth; newborn hearing screening.",
          item3: "Suggested: sterilizer, swaddles, newborn crib.",
        },
        card2: {
          title: "2–6 Months",
          item1: "Encourage rolling and hand-eye playtime.",
          item2: "Vaccines: 5-in-1, pneumococcal, rotavirus.",
          item3: "Suggested: activity mat, teething toys, tummy time pillow.",
        },
        card3: {
          title: "6–12 Months",
          item1: "Introduce solids and support crawling plus standing practice.",
          item2: "Vaccines: MMR, booster Hep B.",
          item3: "Suggested: food processor, learner utensils, soft walkers.",
        },
        card4: {
          title: "12–24 Months",
          item1: "Grow vocabulary and cement day-night routines.",
          item2: "Vaccines: second MMR dose, annual flu season shots.",
          item3: "Suggested: storybooks, toddler high chair, family classes.",
        },
        card5: {
          title: "24–36 Months",
          item1: "Coach toilet independence and emotional expression.",
          item2: "Vaccines: 5-in-1 booster, oral polio.",
          item3: "Suggested: pretend play sets, balance bike, toddler backpack.",
        },
      },
    },
    kits: {
      title: "Smart tools to make every task lighter",
      description:
        "Practical utilities and templates help you prep, track, and plan—your personal command center.",
      card1: {
        title: "Ovulation & Due Date Calculator",
        text: "Estimate fertile windows and due dates with cycle input plus nutrition tips.",
        badge1: "Preconception",
        badge2: "Calendar sync",
      },
      card2: {
        title: "Prenatal Reminder Calendar",
        text: "Auto-build prenatal, screening, and class schedules with one-tap Google/Apple sync.",
        badge1: "Auto reminders",
        badge2: "Share with partner",
      },
      card3: {
        title: "Hospital Checklist",
        text: "Preloaded mom, baby, and paperwork lists you can customize and tick off with shopping sync.",
        badge1: "Pack fast",
        badge2: "Affiliate-ready",
      },
      card4: {
        title: "Postpartum Recovery Tracker",
        text: "Log lochia, mood journals, and feeding notes with expert suggestions auto-surfaced.",
        badge1: "Recovery log",
        badge2: "Ask experts",
      },
      card5: {
        title: "Baby Milestones",
        text: "0–36 month milestones with play ideas, activities, and a one-tap growth album.",
        badge1: "Age reminders",
        badge2: "Interactive practice",
      },
      card6: {
        title: "Collections Hub",
        text: "Organize articles, recipes, and products with notes and checkout nudges.",
        badge1: "Sync across devices",
        badge2: "Share with family",
      },
    },
    affiliate: {
      title: "Curated essentials, ready to shop in one tap",
      description:
        "Recommendations grouped by journey stage so knowledge and shopping stay in sync.",
      card1: {
        category: "Preconception",
        title: "Folic Acid Essentials",
        text: "Multivitamins crafted for early conception to cover folate and B vitamins.",
        link: "View affiliate link →",
      },
      card2: {
        category: "Prenatal Comfort",
        title: "Support Leggings & Pillows",
        text: "Ease waist and back pressure for better sleep with reduced cramps and swelling.",
        link: "View affiliate link →",
      },
      card3: {
        category: "Hospital Bag",
        title: "Mom Bag Essentials",
        text: "From pads to nursing covers, preload everything you need for admission day.",
        link: "View affiliate link →",
      },
      card4: {
        category: "Daily Baby",
        title: "Bottle Care & Food Maker",
        text: "Sanitize and prep baby meals with ease for a safer feeding routine.",
        link: "View affiliate link →",
      },
      card5: {
        category: "Learning & Play",
        title: "Walker Shoes & Balance Bike",
        text: "Build balance and core strength while fueling confident exploration.",
        link: "View affiliate link →",
      },
      card6: {
        category: "Mom Self-Care",
        title: "Postpartum Shaping & Relax Set",
        text: "Support physical recovery and emotional ease for holistic wellbeing.",
        link: "View affiliate link →",
      },
    },
    community: {
      title: "Community support so you’re never alone",
      description:
        "Ask anonymously, join expert streams, and trade heartfelt tips while building your support circle.",
      card1: {
        tag: "#Breastfeeding",
        text: "“How do I soothe midnight wake-ups?” Ten moms share real tricks plus expert latch coaching.",
      },
      card2: {
        tag: "#Vaccines",
        text: "Track vaccine schedules with synced reminders and expert advice on common side effects.",
      },
      card3: {
        tag: "#Solids",
        text: "Stage-based meal plans and nutrition tips paired with deals on baby food makers.",
      },
      card4: {
        tag: "#EmotionalSupport",
        text: "Anonymous postpartum stories with psychologists and peers walking through the transition together.",
      },
      cta: "Join the Community Waitlist",
      alert: "Community features are coming soon—stay tuned!",
    },
    delivery: {
      title: "Your personal library, organized in one place",
      description:
        "Save go-to content, shopping lists, reminders, and growth logs with instant sync across devices.",
      card1: {
        title: "Knowledge Library",
        text: "Articles, videos, and expert talks sorted by stage with highlight notes.",
      },
      card2: {
        title: "Product Tracker",
        text: "Bookmark products with price alerts and promotion tips.",
      },
      card3: {
        title: "Reminders Dashboard",
        text: "Centralize prenatal visits, vaccines, classes, and custom alerts to share with family.",
      },
    },
    cta: {
      title: "Ready to begin your pregnancy journey?",
      description:
        "Mum All Known unites plans, content, reminders, and curated picks—set up your personal guide in minutes.",
      primaryCta: "Create a Free Account",
      secondaryCta: "Talk to Our Team",
    },
    footer: {
      brand: "Mum All Known",
      tagline: "All-in-one pregnancy guide · Smart reminders · Affiliate essentials.",
      resources: {
        title: "Resources",
        item1: "Feature Tour",
        item2: "Stage Guide",
        item3: "Smart Tools",
      },
      support: {
        title: "Support",
        item1: "Community Q&A",
        item2: "Brand Partnerships",
        item3: "Member Services",
      },
      follow: {
        title: "Follow Us",
        item1: "Instagram",
        item2: "Facebook",
        item3: "YouTube",
      },
    },
  },
};

const stageButtons = document.querySelectorAll('.stage-button');
const stagePanels = document.querySelectorAll('.stage-panel');
const navToggle = document.getElementById('navLinks');
const mobileMenuBtn = document.querySelector('.mobile-menu');
const langToggleBtn = document.getElementById('langToggle');
const alertButtons = document.querySelectorAll('[data-alert-key]');
const storageKey = 'mumallknown-lang';

stageButtons.forEach(button => {
  button.addEventListener('click', () => {
    stageButtons.forEach(btn => {
      btn.classList.remove('active');
      btn.setAttribute('aria-selected', 'false');
    });
    stagePanels.forEach(panel => panel.classList.remove('active'));

    const target = document.getElementById(button.dataset.target);
    button.classList.add('active');
    button.setAttribute('aria-selected', 'true');
    if (target) target.classList.add('active');
  });
});

if (mobileMenuBtn)
  mobileMenuBtn.addEventListener('click', () => {
    navToggle?.classList.toggle('open');
  });

window.addEventListener('click', event => {
  if (!mobileMenuBtn || !navToggle) return;
  const isMenuButton = mobileMenuBtn.contains(event.target);
  const isNavLinks = navToggle.contains(event.target);
  if (!isMenuButton && !isNavLinks) {
    navToggle.classList.remove('open');
  }
});

function resolveKey(lang, key) {
  const segments = key.split('.');
  let current = translations[lang];
  for (const segment of segments) {
    if (current && Object.prototype.hasOwnProperty.call(current, segment)) {
      current = current[segment];
    } else {
      current = undefined;
      break;
    }
  }
  if (typeof current === 'undefined' && lang !== 'zh') {
    return resolveKey('zh', key);
  }
  return current;
}

function loadInitialLanguage() {
  try {
    const saved = localStorage.getItem(storageKey);
    return saved && translations[saved] ? saved : 'zh';
  } catch (error) {
    return 'zh';
  }
}

function persistLanguage(lang) {
  try {
    localStorage.setItem(storageKey, lang);
  } catch (error) {
    /* ignore persistence issues */
  }
}

function applyTranslations(lang) {
  const docLang = lang === 'en' ? 'en' : 'zh-Hant';
  document.documentElement.setAttribute('lang', docLang);

  const pageTitle = resolveKey(lang, 'meta.title');
  if (typeof pageTitle === 'string') document.title = pageTitle;

  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.dataset.i18n;
    const value = key ? resolveKey(lang, key) : undefined;
    if (typeof value === 'string') element.textContent = value;
  });

  document.querySelectorAll('[data-i18n-aria-label]').forEach(element => {
    const key = element.dataset.i18nAriaLabel;
    const value = key ? resolveKey(lang, key) : undefined;
    if (typeof value === 'string') element.setAttribute('aria-label', value);
  });

  document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
    const key = element.dataset.i18nPlaceholder;
    const value = key ? resolveKey(lang, key) : undefined;
    if (typeof value === 'string') element.setAttribute('placeholder', value);
  });

  alertButtons.forEach(button => {
    const alertKey = button.dataset.alertKey;
    const value = alertKey ? resolveKey(lang, alertKey) : undefined;
    if (typeof value === 'string') button.dataset.alertMessage = value;
  });
}

let currentLang = loadInitialLanguage();
applyTranslations(currentLang);

if (langToggleBtn) {
  langToggleBtn.addEventListener('click', () => {
    currentLang = currentLang === 'zh' ? 'en' : 'zh';
    applyTranslations(currentLang);
    persistLanguage(currentLang);
  });
}

alertButtons.forEach(button => {
  button.addEventListener('click', () => {
    const message =
      button.dataset.alertMessage || resolveKey(currentLang, button.dataset.alertKey || '');
    if (typeof message === 'string') window.alert(message);
  });
});
